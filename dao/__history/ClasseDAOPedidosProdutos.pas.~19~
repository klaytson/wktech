unit ClasseDAOPedidosProdutos;

interface

Uses ClassePedidosProdutos, UDMPrincipal, System.SysUtils, ClasseMain;

Type
  TDAOPedidosProdutos = class

    public
      procedure Inserir(PedidosProdutos: TPedidosProdutos);
      procedure Salvar(PedidosProdutos: TPedidosProdutos);
      Function ObterNumeroPedido(): Integer;
      function Abrir(NumeroPedido: Integer): TMain;
  end;

implementation

{ DAOClientes }

function TDAOPedidosProdutos.Abrir(NumeroPedido: Integer): TMain;
var
  ObjMain: TMain;
begin
    With DmPrincipal.QryPedidosProdutos Do
    begin
      Close;
      Params[0].Value := NumeroPedido;
      Open;
    end;
end;

procedure TDAOPedidosProdutos.Inserir(pedidosProdutos: TPedidosProdutos);
Var
  objPedidosProdutos: TPedidosProdutos;
  codigopedido: integer;
begin
  objPedidosProdutos := TPedidosProdutos.Create();
  objPedidosProdutos := pedidosProdutos;

  With DmPrincipal.QryAux Do
    begin
      Close;
      SQL.Clear;
      SQL.Add('INSERT INTO `wktech`.`pedidos_produtos` (`NUMEROPEDIDO`, `CODIGOPRODUTO`, `QUANTIDADE`, `VALORUNITARIO`, `VALORTOTAL`) ' +
      ' VALUES (:pedido, :cod, :quantidade, :unitario, :total)');

      ParamByName('pedido').Value := objPedidosProdutos.NumeroPedido;
      ParamByName('cod').AsInteger := objPedidosProdutos.CodigoProduto;
      ParamByName('quantidade').Value := objPedidosProdutos.Quantidade;
      ParamByName('unitario').value := objPedidosProdutos.ValorUnitario;
      ParamByName('total').Value := objPedidosProdutos.ValorTotal;
      ExecSQL;
    end;
end;

function TDAOPedidosProdutos.ObterNumeroPedido: Integer;
begin
  With DmPrincipal.QryAux Do
    begin
      Close;
      SQL.Clear;
      SQL.Add('SELECT NUMEROPEDIDO FROM wktech.pedidos_dados_gerais ORDER BY NUMEROPEDIDO DESC LIMIT 1');
      Open;

      Result := FieldByName('NUMEROPEDIDO').AsInteger;
    end;
end;

procedure TDAOPedidosProdutos.Salvar(PedidosProdutos: TPedidosProdutos);
begin

end;

end.
